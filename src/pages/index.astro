---
import BaseLayout from '../layouts/BaseLayout.astro';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import PostCard from '../components/PostCard.astro';
import Paginator from '../components/Paginator.astro';
import { getPosts } from '../data/wp';

// Get first page of posts for homepage
const postsPerPage = 6;
const currentPage = 1;
const { items: posts, totalPages } = await getPosts({ page: currentPage, perPage: postsPerPage });
---

<BaseLayout title="nico.ar - Notes on Design & Tech" description="Personal blog about design, technology, and user experience by NicolÃ¡s Zicarelli from Buenos Aires, Argentina.">
  <Header slot="header" />
  
  <!-- Main content section with proper container structure to prevent horizontal overflow -->
  <div class="section py-2 mt-2 mb-2 mb-sm-3">
    <!-- Enhanced grid spacing: more horizontal space between columns on desktop -->
    <div class="row posts-grid gx-3 gx-lg-4 gx-xl-5 gy-4">
      {posts.map(post => (
        <div class="col-12 col-lg-6 mb-4">
          <PostCard post={post} />
        </div>
      ))}
    </div>
    
    <Paginator 
      currentPage={currentPage} 
      totalPages={totalPages}
      baseUrl="/page"
    />
  </div>
  
  <!-- Script to save current page in sessionStorage when clicking article links -->
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      // Save current page info when user clicks on article links
      const articleLinks = document.querySelectorAll('a[href^="/posts/"]');
      articleLinks.forEach(link => {
        link.addEventListener('click', () => {
          // Store that user came from page 1 (homepage)
          sessionStorage.setItem('blog-return-page', '/');
        });
      });
    });
  </script>
  
  <Footer slot="footer" />
</BaseLayout>
