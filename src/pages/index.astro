---
import BaseLayout from '../layouts/BaseLayout.astro';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import PostCard from '../components/PostCard.astro';
import Paginator from '../components/Paginator.astro';
import { getPosts } from '../data/wp.ts';

// Get current page from URL params
const currentPage = parseInt(Astro.url.searchParams.get('page') || '1');
const postsPerPage = 10;

// Fetch posts for current page
const posts = await getPosts(currentPage, postsPerPage);

// Calculate total pages (for mock data, we'll assume 2 pages)
const totalPages = 2; // In a real app, this would come from the API headers or a separate call
---

<BaseLayout title="nico.ar - Notes on Design & Tech" description="Personal blog about design, technology, and user experience by Nicolas from Buenos Aires.">
  <Header slot="header" />
  
  <div class="section">
    <div class="row">
      {posts.map(post => (
        <div class="col-12 col-md-6 mb-4">
          <PostCard post={post} />
        </div>
      ))}
    </div>
    
    <Paginator 
      currentPage={currentPage} 
      totalPages={totalPages} 
    />
  </div>
  
  <Footer slot="footer" />
</BaseLayout>
